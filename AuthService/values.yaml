replicaCount: 1

microservice:
  name: farm-auth
  namespace: poultry
  port: 8081

image:
  repository: 208940303379.dkr.ecr.ap-south-2.amazonaws.com/poultry/farm_auth
  pullPolicy: IfNotPresent
  tag: "v1.0.1"

env:
  SPRING_APPLICATION_NAME: farm

  SERVER_PORT:  8083 

  # SPRING_DATASOURCE_URL:  jdbc:postgresql://ep-rough-haze-a18iashw-pooler.ap-southeast-1.aws.neon.tech:5432/neondb?sslmode=require 
  # SPRING_DATASOURCE_USERNAME: neondb_owner
  # SPRING_DATASOURCE_PASSWORD: npg_vWzZQdJ82Ppt

  SPRING_JPA_HIBERNATE_DEFAULT_SCHEMA: poultryfarm

  SPRING_JPA_HIBERNATE_DDL_AUTO: update
  SPRING_JPA_SHOW_SQL: "false"
  SPRING_JPA_HIBERNATE_NON_CONTEXTUAL_CREATION: "true"

  APP_CORS_ALLOWED_ORIGINS: "*"

  MANAGEMENT_ENDPOINT_HEALTH_PROBES_ENABLED: "true"
  MANAGEMENT_HEALTH_LIVENESSSTATE_ENABLED: "true"
  MANAGEMENT_HEALTH_READINESSSTATE_ENABLED: "true"
  MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE: "health"

envFromSecret:
  SPRING_DATASOURCE_URL:
    name: postgres-credentials
    key: POSTGRES_URL
  SPRING_DATASOURCE_USERNAME:
    name: postgres-credentials
    key: POSTGRES_USER
  SPRING_DATASOURCE_PASSWORD:
    name: postgres-credentials
    key: POSTGRES_PASSWORD


resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

nodeSelector:
  kubernetes.io/arch: amd64

tolerations:
  - key: "arch"
    operator: "Equal"
    value: "x86"
    effect: "PreferNoSchedule"

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  # Optional:
  # targetMemoryUtilizationPercentage: 75

livenessProbe:
  path: "actuator/health/liveness"
  initialDelaySeconds: 180
  periodSeconds: 10

readinessProbe:
  path: "actuator/health/readiness"
  initialDelaySeconds: 150
  periodSeconds: 10

service:
  type: NodePort
  port: 80
  nodePort: 30099

gateway_service:
  namespace: istio-gateway
#some thi

httprouts:
  hostnames: ["hrms.anasolconsultancyservices.com"]
  path: "/api/farm_auth"
  timeout_request: "3s"
  retry_codes: [500, 502, 503, 504]
  retry_attempts: 3
  retry_backoff: "1s"

serviceAccount:
  annotations:
    example.com/annotation: "value"
  rules:
    - apiGroups: [""]
      resources: ["pods", "services", "endpoints"]
      verbs: ["get", "list", "watch"]

argo_cd:
  helm_url: 'https://koteshwarchinnolla.github.io/helm-utilities/charts'
  chart_name: hrms-microservices
  chart_version: 0.1.0
  path_to_values: AuthService/values.yaml
  microservice_repo_url: 'https://github.com/KoteshwarChinnolla/TECHLIFE-BACKEND'
  branch: poultry
  destination_server: https://kubernetes.default.svc


# kubectl create ns poultry
# helm upgrade --install farmauth hrms-helm/hrms-microservices -f ./AuthService/values.yaml --namespace hrms

# creat the databse passwards
# POSTGRESUser=$(kubectl get secret postgres-cluster-app -n cnpg-system -o jsonpath="{.data.username}" | base64 --decode)
# POSTGRESPass=$(kubectl get secret postgres-cluster-app -n cnpg-system -o jsonpath="{.data.password}" | base64 --decode)
# POSTGRESUrl="jdbc:postgresql://postgres-cluster-rw.cnpg-system.svc.cluster.local:5432/app"
# kubectl create secret generic postgres-credentials --from-literal=POSTGRES_PASSWORD=${POSTGRESPass} --from-literal=POSTGRES_URL=${POSTGRESUrl} --from-literal=POSTGRES_USER=${POSTGRESUser} -n hrms || echo "secret already exists"